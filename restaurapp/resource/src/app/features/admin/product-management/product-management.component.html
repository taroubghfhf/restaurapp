<div class="product-management-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>
        <span class="icon">üçΩÔ∏è</span>
        Gesti√≥n de Productos
      </h1>
      <p class="subtitle">Administra el men√∫ de productos del restaurante</p>
    </div>
    <button class="btn-primary" (click)="openCreateModal()" [disabled]="isLoading()">
      <span class="btn-icon">+</span>
      Nuevo Producto
    </button>
  </div>

  <!-- Loading Spinner -->
  <app-loading 
    [isLoading]="isLoading()" 
    [fullscreen]="false"
    message="Cargando productos...">
  </app-loading>

  <!-- Tabla de Productos -->
  <div class="card">
    <div class="card-header">
      <h2>Lista de Productos</h2>
      <span class="badge">{{ products().length }} productos</span>
    </div>

    <div class="table-container" *ngIf="!isLoading()">
      <table class="data-table" *ngIf="products().length > 0; else noProducts">
        <thead>
          <tr>
            <th>ID</th>
            <th>Producto</th>
            <th>Categor√≠a</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Estado</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of products(); trackBy: trackByProductId">
            <td>
              <span class="product-id">#{{ product.productId }}</span>
            </td>
            <td>
              <div class="product-name">
                <span class="name-icon">üçΩÔ∏è</span>
                <span class="name-text">{{ product.name }}</span>
              </div>
            </td>
            <td>
              <span class="category-tag">{{ product.category.name }}</span>
            </td>
            <td>
              <div class="price-info">
                <span class="price-symbol">$</span>
                <span class="price-amount">{{ formatPrice(product.price) }}</span>
              </div>
            </td>
            <td>
              <span class="stock-badge" [class.low-stock]="product.stock <= 5 && product.stock > 0" [class.no-stock]="product.stock === 0">
                {{ product.stock }} unidades
              </span>
            </td>
            <td>
              <span class="status-badge" [class]="getStatusClass(product.status)">
                <span class="status-icon">{{ getStatusIcon(product.status) }}</span>
                {{ getStatusText(product.status) }}
              </span>
            </td>
            <td class="actions">
              <button 
                class="btn-action btn-edit"
                (click)="openEditModal(product)"
                [disabled]="isLoading()"
                title="Editar producto">
                ‚úèÔ∏è Editar
              </button>
              <button 
                class="btn-action btn-delete"
                (click)="deleteProduct(product)"
                [disabled]="isLoading()"
                title="Eliminar producto">
                üóëÔ∏è Eliminar
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Empty State -->
      <ng-template #noProducts>
        <div class="empty-state">
          <div class="empty-icon">üçΩÔ∏è</div>
          <h3>No hay productos registrados</h3>
          <p>Comienza creando productos para tu men√∫</p>
          <div class="example-list">
            <p><strong>Necesitas tener categor√≠as creadas primero</strong></p>
            <p class="hint">Ve a Gesti√≥n de Categor√≠as para crear categor√≠as como: Bebidas, Entradas, Platos Fuertes, Postres, etc.</p>
          </div>
          <button class="btn-primary" (click)="openCreateModal()" *ngIf="categories().length > 0">
            <span class="btn-icon">+</span>
            Crear Primer Producto
          </button>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Modal de Crear/Editar -->
  <div class="modal-overlay" *ngIf="showModal()" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>
          <span class="modal-icon">{{ isEditing() ? '‚úèÔ∏è' : '‚ûï' }}</span>
          {{ isEditing() ? 'Editar Producto' : 'Nuevo Producto' }}
        </h2>
        <button class="btn-close" (click)="closeModal()" [disabled]="isLoading()">
          ‚úï
        </button>
      </div>

      <div class="modal-body">
        <form (ngSubmit)="saveProduct()" #productForm="ngForm">
          <!-- ID (solo en modo edici√≥n) -->
          <div class="form-group" *ngIf="isEditing()">
            <label>ID del Producto</label>
            <input 
              type="text" 
              [value]="currentProduct().productId" 
              disabled
              class="form-control">
          </div>

          <!-- Nombre del Producto -->
          <div class="form-group">
            <label for="productName">
              <span class="required">*</span>
              Nombre del Producto
            </label>
            <input 
              type="text"
              id="productName"
              name="productName"
              [ngModel]="currentProduct().name"
              (ngModelChange)="updateProductName($event)"
              required
              maxlength="50"
              placeholder="Ej: Hamburguesa con Queso"
              class="form-control"
              [disabled]="isLoading()"
              #productNameInput="ngModel">
            
            <div class="form-hint" *ngIf="!productNameInput.errors">
              {{ currentProduct().name.length }}/50 caracteres
            </div>
            
            <div class="form-error" *ngIf="productNameInput.touched && productNameInput.errors?.['required']">
              El nombre del producto es requerido
            </div>
          </div>

          <!-- Categor√≠a -->
          <div class="form-group">
            <label for="productCategory">
              <span class="required">*</span>
              Categor√≠a
            </label>
            <select 
              id="productCategory"
              name="productCategory"
              [ngModel]="currentProduct().category.categoryId"
              (ngModelChange)="updateProductCategory($event)"
              required
              class="form-control"
              [disabled]="isLoading() || categories().length === 0"
              #productCategoryInput="ngModel">
              <option value="" disabled selected>Selecciona una categor√≠a</option>
              <option *ngFor="let category of categories()" [value]="category.categoryId">
                {{ category.name }}
              </option>
            </select>
            
            <div class="form-error" *ngIf="productCategoryInput.touched && productCategoryInput.errors?.['required']">
              Debe seleccionar una categor√≠a
            </div>

            <div class="form-warning" *ngIf="categories().length === 0">
              ‚ö†Ô∏è No hay categor√≠as disponibles. <a routerLink="/admin/categories">Crear categor√≠a</a>
            </div>
          </div>

          <!-- Fila: Precio y Stock -->
          <div class="form-row">
            <!-- Precio -->
            <div class="form-group">
              <label for="productPrice">
                <span class="required">*</span>
                Precio
              </label>
              <div class="input-with-prefix">
                <span class="input-prefix">$</span>
                <input 
                  type="number"
                  id="productPrice"
                  name="productPrice"
                  [ngModel]="currentProduct().price"
                  (ngModelChange)="updateProductPrice($event)"
                  required
                  min="0"
                  step="0.01"
                  placeholder="0.00"
                  class="form-control with-prefix"
                  [disabled]="isLoading()"
                  #productPriceInput="ngModel">
              </div>
              
              <div class="form-error" *ngIf="productPriceInput.touched && productPriceInput.errors?.['required']">
                El precio es requerido
              </div>
              
              <div class="form-error" *ngIf="productPriceInput.touched && productPriceInput.errors?.['min']">
                El precio debe ser mayor o igual a 0
              </div>
            </div>

            <!-- Stock -->
            <div class="form-group">
              <label for="productStock">
                <span class="required">*</span>
                Stock
              </label>
              <input 
                type="number"
                id="productStock"
                name="productStock"
                [ngModel]="currentProduct().stock"
                (ngModelChange)="updateProductStock($event)"
                required
                min="0"
                step="1"
                placeholder="0"
                class="form-control"
                [disabled]="isLoading()"
                #productStockInput="ngModel">
              
              <div class="form-hint" *ngIf="!productStockInput.errors">
                Unidades disponibles
              </div>
              
              <div class="form-error" *ngIf="productStockInput.touched && productStockInput.errors?.['required']">
                El stock es requerido
              </div>
              
              <div class="form-error" *ngIf="productStockInput.touched && productStockInput.errors?.['min']">
                El stock debe ser mayor o igual a 0
              </div>
            </div>
          </div>

          <!-- Estado -->
          <div class="form-group">
            <label>Estado del Producto</label>
            <div class="status-toggle">
              <button 
                type="button"
                class="toggle-btn"
                [class.active]="currentProduct().status"
                (click)="toggleProductStatus()"
                [disabled]="isLoading()">
                <span class="toggle-icon">{{ getStatusIcon(currentProduct().status) }}</span>
                <span class="toggle-text">{{ getStatusText(currentProduct().status) }}</span>
              </button>
              <p class="toggle-hint">
                {{ currentProduct().status ? 'El producto est√° disponible en el men√∫' : 'El producto est√° oculto del men√∫' }}
              </p>
            </div>
          </div>

          <!-- Resumen -->
          <div class="product-summary" *ngIf="currentProduct().name && currentProduct().category.categoryId">
            <h4>üìã Resumen del Producto:</h4>
            <div class="summary-content">
              <div class="summary-item">
                <span class="label">Producto:</span>
                <span class="value">{{ currentProduct().name }}</span>
              </div>
              <div class="summary-item">
                <span class="label">Categor√≠a:</span>
                <span class="value">{{ currentProduct().category.name }}</span>
              </div>
              <div class="summary-item">
                <span class="label">Precio:</span>
                <span class="value price">${{ formatPrice(currentProduct().price) }}</span>
              </div>
              <div class="summary-item">
                <span class="label">Stock:</span>
                <span class="value">{{ currentProduct().stock }} unidades</span>
              </div>
              <div class="summary-item">
                <span class="label">Estado:</span>
                <span class="status-badge" [class]="getStatusClass(currentProduct().status)">
                  {{ getStatusIcon(currentProduct().status) }} {{ getStatusText(currentProduct().status) }}
                </span>
              </div>
            </div>
          </div>

          <!-- Botones -->
          <div class="modal-actions">
            <button 
              type="button" 
              class="btn-secondary"
              (click)="closeModal()"
              [disabled]="isLoading()">
              Cancelar
            </button>
            <button 
              type="submit" 
              class="btn-primary"
              [disabled]="!productForm.valid || isLoading()">
              <span *ngIf="!isLoading()">
                {{ isEditing() ? 'üíæ Actualizar' : '‚ûï Crear' }}
              </span>
              <span *ngIf="isLoading()">
                Guardando...
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>



